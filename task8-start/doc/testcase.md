# 跳跳棋活动系统功能测试用例

## 目录

1. [测试概述](#1-测试概述)
   - [1.1 测试目的](#11-测试目的)
   - [1.2 测试范围](#12-测试范围)
   - [1.3 测试环境](#13-测试环境)
   - [1.4 测试策略](#14-测试策略)

2. [活动管理测试](#2-活动管理测试)
   - [2.1 活动基本信息测试](#21-活动基本信息测试)
   - [2.2 活动状态测试](#22-活动状态测试)

3. [跳跳棋游戏测试](#3-跳跳棋游戏测试)
   - [3.1 游戏机会获取测试](#31-游戏机会获取测试)
     - [3.1.1 礼物赠送获取游戏机会-正常场景](#311-礼物赠送获取游戏机会-正常场景)
     - [3.1.2 礼物赠送获取游戏机会-多种礼物组合](#312-礼物赠送获取游戏机会-多种礼物组合)
     - [3.1.3 礼物赠送获取游戏机会-活动未开始](#313-礼物赠送获取游戏机会-活动未开始)
     - [3.1.4 礼物赠送获取游戏机会-活动已结束](#314-礼物赠送获取游戏机会-活动已结束)
     - [3.1.5 礼物赠送获取游戏机会-非限定礼物](#315-礼物赠送获取游戏机会-非限定礼物)
   - [3.2 游戏进行测试](#32-游戏进行测试)
     - [3.2.1 使用游戏机会-单次使用](#321-使用游戏机会-单次使用)
     - [3.2.2 使用游戏机会-多次使用](#322-使用游戏机会-多次使用)
     - [3.2.3 使用游戏机会-机会不足](#323-使用游戏机会-机会不足)
     - [3.2.4 使用游戏机会-超过单日限制](#324-使用游戏机会-超过单日限制)
     - [3.2.5 使用游戏机会-频繁请求限制](#325-使用游戏机会-频繁请求限制)
   - [3.3 游戏奖励测试](#33-游戏奖励测试)
   - [3.4 游戏进度测试](#34-游戏进度测试)
   - [3.5 游戏边界条件测试](#35-游戏边界条件测试)
     - [3.5.1 游戏进度-重置验证](#351-游戏进度-重置验证)
     - [3.5.2 游戏进度-超过终点处理](#352-游戏进度-超过终点处理)

4. [宝箱兑换测试](#4-宝箱兑换测试)
   - [4.1 宝箱列表测试](#41-宝箱列表测试)
     - [4.1.1 获取宝箱列表-正常场景](#411-获取宝箱列表-正常场景)
     - [4.1.2 获取宝箱列表-活动未开始](#412-获取宝箱列表-活动未开始)
     - [4.1.3 获取宝箱列表-活动已结束](#413-获取宝箱列表-活动已结束)
     - [4.1.4 获取宝箱列表-无宝箱配置](#414-获取宝箱列表-无宝箱配置)
   - [4.2 宝箱兑换测试](#42-宝箱兑换测试)
     - [4.2.1 兑换宝箱-积分充足](#421-兑换宝箱-积分充足)
     - [4.2.2 兑换宝箱-积分不足](#422-兑换宝箱-积分不足)
     - [4.2.3 兑换宝箱-重复兑换](#423-兑换宝箱-重复兑换)
     - [4.2.4 兑换宝箱-宝箱不存在](#424-兑换宝箱-宝箱不存在)
     - [4.2.5 兑换宝箱-达到每日限制](#425-兑换宝箱-达到每日限制)
     - [4.2.6 兑换宝箱-达到总限制](#426-兑换宝箱-达到总限制)
     - [4.2.7 兑换宝箱-并发兑换](#427-兑换宝箱-并发兑换)
   - [4.3 兑换记录测试](#43-兑换记录测试)
     - [4.3.1 获取兑换记录-正常场景](#431-获取兑换记录-正常场景)
     - [4.3.2 获取兑换记录-无记录](#432-获取兑换记录-无记录)
     - [4.3.3 获取兑换记录-分页查询](#433-获取兑换记录-分页查询)
     - [4.3.4 获取兑换记录-排序验证](#434-获取兑换记录-排序验证)

5. [排行榜测试](#5-排行榜测试)
   - [5.1 积分排行榜测试](#51-积分排行榜测试)
   - [5.2 排行榜奖励测试](#52-排行榜奖励测试)
   - [5.3 个人排名测试](#53-个人排名测试)

6. [综合功能测试](#6-综合功能测试)
   - [6.1 用户活动数据测试](#61-用户活动数据测试)
   - [6.2 一次性获取所有数据测试](#62-一次性获取所有数据测试)

7. [性能测试](#7-性能测试)
   - [7.1 并发测试](#71-并发测试)
   - [7.2 响应时间测试](#72-响应时间测试)

8. [安全测试](#8-安全测试)
   - [8.1 权限控制测试](#81-权限控制测试)
   - [8.2 数据安全测试](#82-数据安全测试)

## 1. 测试概述

### 1.1 测试目的

本测试用例文档旨在验证跳跳棋活动系统的功能完整性、正确性和稳定性，确保系统满足产品需求文档中定义的所有功能要求。通过系统化的测试，发现并解决潜在问题，保证系统在上线后能够稳定运行。

### 1.2 测试范围

测试范围包括但不限于以下方面：
- 活动管理功能
- 跳跳棋游戏核心功能
- 宝箱兑换功能
- 排行榜系统功能
- 系统性能和安全性

### 1.3 测试环境

- **开发环境**：Java 11, Spring Boot 2.6.x, MySQL 8.0
- **测试工具**：JUnit 5, Mockito, Postman
- **测试数据库**：独立的测试数据库实例
- **测试账号**：多个不同权限级别的测试账号

### 1.4 测试策略

- **单元测试**：验证各个组件的独立功能
- **集成测试**：验证组件间的交互
- **功能测试**：验证系统是否满足功能需求
- **性能测试**：验证系统在高负载下的表现
- **安全测试**：验证系统的安全防护措施

## 2. 活动管理测试

### 2.1 活动基本信息测试

#### TC-2.1.1 获取活动信息-正常场景

**测试目的**：验证系统能够正确返回活动的基本信息

**前置条件**：
- 数据库中存在有效的活动数据
- 用户已登录系统

**测试步骤**：
1. 调用获取活动信息API（GET /api/activity/{activityId}）
2. 检查返回的活动信息

**预期结果**：
- 返回状态码为200
- 返回数据包含正确的活动ID、名称、开始时间、结束时间、描述和规则
- 数据格式符合API文档规范

**验证标准**：
- 返回的活动信息与数据库中的记录一致
- 所有字段格式正确

#### TC-2.1.2 获取活动信息-活动不存在

**测试目的**：验证系统对不存在的活动ID的处理

**前置条件**：
- 用户已登录系统

**测试步骤**：
1. 调用获取活动信息API，使用一个不存在的活动ID
2. 检查系统响应

**预期结果**：
- 返回状态码为404
- 返回错误信息表明活动不存在

**验证标准**：
- 系统返回适当的错误码和错误信息
- 不会导致系统异常

#### TC-2.1.3 获取活动信息-无权限访问

**测试目的**：验证系统的权限控制机制

**前置条件**：
- 数据库中存在有效的活动数据
- 用户未登录或无权限访问

**测试步骤**：
1. 未登录状态下调用获取活动信息API
2. 检查系统响应

**预期结果**：
- 返回状态码为401或403
- 返回错误信息表明用户无权限

**验证标准**：
- 系统正确拒绝未授权的访问
- 返回适当的错误信息

### 2.2 活动状态测试

#### TC-2.2.1 活动状态检查-进行中

**测试目的**：验证系统能够正确识别进行中的活动状态

**前置条件**：
- 数据库中存在当前时间处于开始时间和结束时间之间的活动

**测试步骤**：
1. 调用获取活动状态API（GET /api/activity/{activityId}/status）
2. 检查返回的活动状态

**预期结果**：
- 返回状态码为200
- 活动状态为"进行中"（status=1）

**验证标准**：
- 返回的活动状态与预期一致
- 状态判断逻辑正确

#### TC-2.2.2 活动状态检查-未开始

**测试目的**：验证系统能够正确识别未开始的活动状态

**前置条件**：
- 数据库中存在开始时间晚于当前时间的活动

**测试步骤**：
1. 调用获取活动状态API
2. 检查返回的活动状态

**预期结果**：
- 返回状态码为200
- 活动状态为"未开始"（status=0）

**验证标准**：
- 返回的活动状态与预期一致
- 状态判断逻辑正确

#### TC-2.2.3 活动状态检查-已结束

**测试目的**：验证系统能够正确识别已结束的活动状态

**前置条件**：
- 数据库中存在结束时间早于当前时间的活动

**测试步骤**：
1. 调用获取活动状态API
2. 检查返回的活动状态

**预期结果**：
- 返回状态码为200
- 活动状态为"已结束"（status=2）

**验证标准**：
- 返回的活动状态与预期一致
- 状态判断逻辑正确

#### TC-2.2.4 活动状态变更测试

**测试目的**：验证系统能够正确处理活动状态的自动变更

**前置条件**：
- 数据库中存在即将开始或即将结束的活动

**测试步骤**：
1. 记录当前活动状态
2. 等待活动状态变更时间点（开始时间或结束时间）
3. 再次调用获取活动状态API
4. 检查返回的活动状态是否已更新

**预期结果**：
- 活动状态根据当前时间自动更新
- 未开始→进行中，或进行中→已结束

**验证标准**：
- 状态变更及时准确
- 不需要手动干预
## 3. 跳跳棋游戏测试

### 3.1 游戏机会获取测试

#### TC-3.1.1 礼物赠送获取游戏机会-正常场景

**测试目的**：验证用户通过赠送礼物能够正确获取游戏机会

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 礼物机会配置表中存在有效配置

**测试步骤**：
1. 模拟用户赠送礼物事件（通过消息队列或直接API调用）
2. 检查用户游戏机会是否增加

**预期结果**：
- 用户游戏机会增加，数量与礼物机会配置一致
- 系统返回成功响应

**验证标准**：
- 数据库中用户游戏进度表的剩余机会字段正确更新
- 返回的游戏机会数量与预期一致

#### TC-3.1.2 礼物赠送获取游戏机会-多种礼物组合

**测试目的**：验证系统能够正确处理多种礼物组合的情况

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 礼物机会配置表中存在多种礼物的配置

**测试步骤**：
1. 模拟用户赠送多种不同礼物
2. 检查用户游戏机会的增加情况

**预期结果**：
- 用户游戏机会增加，总数量为各礼物对应机会的总和
- 系统返回成功响应

**验证标准**：
- 数据库中用户游戏进度表的剩余机会字段正确更新
- 返回的游戏机会数量与预期一致

#### TC-3.1.3 礼物赠送获取游戏机会-活动未开始

**测试目的**：验证系统在活动未开始时的处理逻辑

**前置条件**：
- 活动状态为未开始
- 用户已登录系统

**测试步骤**：
1. 模拟用户赠送礼物事件
2. 检查系统响应和用户游戏机会

**预期结果**：
- 系统返回错误信息，表明活动未开始
- 用户游戏机会不增加

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户游戏进度表的剩余机会字段未变化

#### TC-3.1.4 礼物赠送获取游戏机会-活动已结束

**测试目的**：验证系统在活动已结束时的处理逻辑

**前置条件**：
- 活动状态为已结束
- 用户已登录系统

**测试步骤**：
1. 模拟用户赠送礼物事件
2. 检查系统响应和用户游戏机会

**预期结果**：
- 系统返回错误信息，表明活动已结束
- 用户游戏机会不增加

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户游戏进度表的剩余机会字段未变化

#### TC-3.1.5 礼物赠送获取游戏机会-非限定礼物

**测试目的**：验证系统对非限定礼物（未在礼物机会配置表中的礼物）的处理逻辑

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 礼物机会配置表中存在特定礼物的配置
- 用户赠送的礼物不在礼物机会配置表中

**测试步骤**：
1. 模拟用户赠送非限定礼物事件
2. 检查系统响应和用户游戏机会

**预期结果**：
- 系统不增加用户游戏机会
- 用户游戏机会保持不变

**验证标准**：
- 数据库中用户游戏进度表的剩余机会字段未变化
- 系统正确识别并忽略非限定礼物

### 3.2 游戏进行测试

#### TC-3.2.1 使用游戏机会-单次使用

**测试目的**：验证用户能够正确使用单次游戏机会

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的游戏机会

**测试步骤**：
1. 调用使用游戏机会API（POST /api/game/play），参数为使用1次机会
2. 检查骰子点数和移动结果

**预期结果**：
- 返回状态码为200
- 返回数据包含骰子点数（1-6之间）、起始位置、结束位置和获得的奖励
- 用户游戏机会减少1次

**验证标准**：
- 骰子点数在有效范围内
- 结束位置 = 起始位置 + 骰子点数
- 数据库中用户游戏进度表的剩余机会和当前位置字段正确更新
- 游戏记录表中新增一条记录

#### TC-3.2.2 使用游戏机会-多次连续使用

**测试目的**：验证用户能够正确使用多次游戏机会

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的游戏机会（至少5次）

**测试步骤**：
1. 调用使用游戏机会API，参数为使用5次机会
2. 检查骰子点数和移动结果

**预期结果**：
- 返回状态码为200
- 返回数据包含5个骰子点数、起始位置、结束位置和获得的奖励
- 用户游戏机会减少5次

**验证标准**：
- 所有骰子点数在有效范围内
- 结束位置 = 起始位置 + 所有骰子点数之和
- 数据库中用户游戏进度表的剩余机会和当前位置字段正确更新
- 游戏记录表中新增一条记录，包含所有骰子点数

#### TC-3.2.3 使用游戏机会-机会不足

**测试目的**：验证系统对游戏机会不足情况的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户游戏机会不足（例如只有2次，但尝试使用3次）

**测试步骤**：
1. 调用使用游戏机会API，参数为使用3次机会
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误
- 返回错误信息表明游戏机会不足
- 用户游戏机会不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户游戏进度表的剩余机会字段未变化
- 游戏记录表中未新增记录

#### TC-3.2.4 使用游戏机会-超过单日限制

**测试目的**：验证系统对单日游戏次数限制的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户当日已使用游戏机会接近限制（例如已使用119次，限制为120次/天）

**测试步骤**：
1. 调用使用游戏机会API，参数为使用2次机会
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误
- 返回错误信息表明超过单日限制
- 用户游戏机会不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户游戏进度表的剩余机会字段未变化
- 游戏记录表中未新增记录

#### TC-3.2.5 使用游戏机会-频繁请求限制

**测试目的**：验证系统对短时间内频繁掷骰子请求的处理机制

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的游戏机会

**测试步骤**：
1. 在短时间内（例如1秒内）连续多次调用使用游戏机会API
2. 检查系统响应

**预期结果**：
- 系统应对频繁请求进行限制
- 返回状态码表示错误
- 返回错误信息表明请求过于频繁
- 用户游戏机会不应全部被消耗

**验证标准**：
- 系统返回适当的错误码和错误信息，指示请求频率限制
- 系统应有合理的限流机制，防止恶意请求
- 数据库中用户游戏进度表的剩余机会字段应只减少成功请求的次数
- 游戏记录表中只记录成功的游戏请求
- 用户已登录系统
- 用户当日已使用游戏机会接近限制（例如已使用119次，限制为120次/天）

**测试步骤**：
1. 调用使用游戏机会API，参数为使用2次机会
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误
- 返回错误信息表明超过单日限制
- 用户游戏机会不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户游戏进度表的剩余机会字段未变化
- 游戏记录表中未新增记录

### 3.3 游戏奖励测试

#### TC-3.3.1 获取积分奖励

**测试目的**：验证用户在游戏中能够正确获取积分奖励

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的游戏机会
- 游戏格子配置中存在积分奖励的格子

**测试步骤**：
1. 调用使用游戏机会API
2. 确保用户落在积分奖励格子上（可能需要多次尝试或模拟特定骰子点数）
3. 检查用户获得的积分

**预期结果**：
- 用户获得对应格子配置的积分奖励
- 用户总积分增加

**验证标准**：
- 数据库中用户积分表的积分字段正确更新
- 用户奖励记录表中新增一条积分奖励记录
- 返回的奖励信息与格子配置一致

#### TC-3.3.2 获取道具奖励-首次获取

**测试目的**：验证用户在游戏中能够正确获取道具奖励

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的游戏机会
- 游戏格子配置中存在道具奖励的格子
- 用户未曾获得该道具

**测试步骤**：
1. 调用使用游戏机会API
2. 确保用户落在道具奖励格子上
3. 检查用户获得的道具

**预期结果**：
- 用户获得对应格子配置的道具奖励
- 系统记录用户已领取该道具

**验证标准**：
- 用户奖励记录表中新增一条道具奖励记录
- 用户道具领取记录表中新增一条记录
- 返回的奖励信息与格子配置一致

#### TC-3.3.3 获取道具奖励-重复获取

**测试目的**：验证系统对重复获取道具的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的游戏机会
- 游戏格子配置中存在道具奖励的格子
- 用户已经获得过该道具

**测试步骤**：
1. 调用使用游戏机会API
2. 确保用户再次落在同一道具奖励格子上
3. 检查用户获得的奖励

**预期结果**：
- 用户获得替代积分奖励，而非重复道具
- 用户总积分增加

**验证标准**：
- 数据库中用户积分表的积分字段增加了替代积分
- 用户奖励记录表中新增一条积分奖励记录
- 返回的奖励信息显示为替代积分

### 3.4 游戏进度测试

#### TC-3.4.1 游戏进度保存-正常场景

**测试目的**：验证系统能够正确保存用户的游戏进度

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有游戏进度记录

**测试步骤**：
1. 记录用户当前游戏位置
2. 调用使用游戏机会API
3. 检查用户游戏进度是否更新

**预期结果**：
- 用户游戏位置更新为新的位置
- 系统正确保存更新后的进度

**验证标准**：
- 数据库中用户游戏进度表的当前位置字段正确更新
- 再次查询用户进度时返回正确的位置

#### TC-3.4.2 游戏进度重置-到达终点

**测试目的**：验证用户到达终点后游戏进度的重置

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户当前位置接近终点

**测试步骤**：
1. 调用使用游戏机会API，确保用户移动后到达或超过终点
2. 检查用户游戏进度

**预期结果**：
- 用户获得终点奖励
- 用户游戏位置重置为起点（位置0）

**验证标准**：
- 数据库中用户游戏进度表的当前位置字段重置为0
- 用户奖励记录表中新增一条终点奖励记录
- 再次查询用户进度时返回位置为0

#### TC-3.4.3 游戏进度查询

**测试目的**：验证系统能够正确返回用户的游戏进度

**前置条件**：
- 用户已登录系统
- 用户有游戏进度记录

**测试步骤**：
1. 调用获取游戏进度API（GET /api/game/progress）
2. 检查返回的游戏进度信息

**预期结果**：
- 返回状态码为200
- 返回数据包含用户当前位置、剩余游戏机会、当日已使用机会等信息

**验证标准**：
- 返回的游戏进度与数据库中的记录一致
- 所有字段格式正确

### 3.5 游戏边界条件测试

#### TC-3.5.1 使用游戏机会-最大次数限制

**测试目的**：验证系统对单次使用最大游戏机会数的限制

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的游戏机会（超过系统限制）

**测试步骤**：
1. 调用使用游戏机会API，参数为使用11次机会（超过10次限制）
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误
- 返回错误信息表明超过单次使用限制
- 用户游戏机会不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户游戏进度表的剩余机会字段未变化

#### TC-3.5.2 游戏进度-超过终点处理

**测试目的**：验证系统对超过终点情况的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户当前位置接近终点（例如位于第28格，终点为第30格）

**测试步骤**：
1. 调用使用游戏机会API，确保骰子点数使用户超过终点（例如骰子点数为5）
2. 检查用户游戏进度和奖励

**预期结果**：
- 用户直接到达终点（第30格），而不是超过终点
- 用户获得终点奖励
- 用户游戏位置重置为起点

**验证标准**：
- 系统正确处理超过终点的情况
- 数据库中用户游戏进度表的当前位置字段重置为0
- 用户获得终点奖励

#### TC-3.5.3 连续使用机会-跨越终点处理

**测试目的**：验证系统对连续使用机会跨越终点情况的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户当前位置接近终点（例如位于第28格，终点为第30格）

**测试步骤**：
1. 调用使用游戏机会API，参数为使用3次机会
2. 假设三次骰子点数分别为3、4、2
3. 检查用户游戏进度和奖励

**预期结果**：
- 第一次骰子（3点）使用户到达终点前（第28+3=31格，超过终点，直接到达终点第30格）
- 用户获得终点奖励
- 用户游戏位置重置为起点
- 第二次骰子（4点）从起点开始计算，用户移动到第4格
- 第三次骰子（2点）用户从第4格移动到第6格
- 最终用户位于第6格

**验证标准**：
- 系统正确处理连续使用机会跨越终点的情况
- 数据库中用户游戏进度表的当前位置字段为6
- 用户获得终点奖励和途经格子的奖励
## 4. 宝箱兑换测试

### 4.1 宝箱列表测试

#### TC-4.1.1 获取宝箱列表-正常场景

**测试目的**：验证系统能够正确返回活动的宝箱列表

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 数据库中存在宝箱配置
- 用户已兑换部分宝箱

**测试步骤**：
1. 调用获取宝箱列表API（GET /api/box/list）
2. 检查返回的宝箱列表

**预期结果**：
- 返回状态码为200
- 返回数据包含用户当前积分
- 返回数据包含所有可用宝箱的信息，包括ID、名称、等级、所需积分、奖励详情等
- 已兑换的宝箱标记为exchanged=true

**验证标准**：
- 返回的宝箱列表与数据库中的配置一致
- 所有字段格式正确
- 宝箱的兑换状态与用户实际兑换记录一致
- 用户积分显示正确

#### TC-4.1.2 获取宝箱列表-活动未开始

**测试目的**：验证系统在活动未开始时的处理逻辑

**前置条件**：
- 活动状态为未开始
- 用户已登录系统

**测试步骤**：
1. 调用获取宝箱列表API
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误（非0）
- 返回错误信息表明活动未开始（错误码2001）

**验证标准**：
- 系统返回适当的错误码和错误信息
- 错误信息清晰明确

#### TC-4.1.3 获取宝箱列表-活动已结束

**测试目的**：验证系统在活动已结束时的处理逻辑

**前置条件**：
- 活动状态为已结束
- 用户已登录系统

**测试步骤**：
1. 调用获取宝箱列表API
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误（非0）
- 返回错误信息表明活动已结束（错误码2002）

**验证标准**：
- 系统返回适当的错误码和错误信息
- 错误信息清晰明确

#### TC-4.1.4 获取宝箱列表-无宝箱配置

**测试目的**：验证系统在活动没有宝箱配置时的处理逻辑

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 数据库中不存在该活动的宝箱配置

**测试步骤**：
1. 调用获取宝箱列表API
2. 检查系统响应

**预期结果**：
- 返回状态码为200
- 返回数据中boxes为空数组
- 返回用户当前积分

**验证标准**：
- 系统正确处理无宝箱配置的情况
- 返回格式符合API规范
- 不会因为无数据而报错

### 4.2 宝箱兑换测试

#### TC-4.2.1 兑换宝箱-积分充足

**测试目的**：验证用户能够成功兑换宝箱

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的积分（例如用户有3000积分，宝箱需要2000积分）
- 用户未兑换过该宝箱
- 宝箱未达到兑换限制

**测试步骤**：
1. 记录用户当前积分
2. 调用兑换宝箱API（POST /api/box/exchange），参数为宝箱ID
3. 检查兑换结果和用户积分变化

**预期结果**：
- 返回状态码为200
- 返回数据表明兑换成功，包含兑换记录ID、宝箱信息、消耗积分、获得的奖励信息和剩余积分
- 用户积分减少，减少量等于宝箱所需积分（例如剩余1000积分）

**验证标准**：
- 数据库中用户积分表（demo_user_points）的积分字段正确更新
- 用户宝箱兑换表（demo_user_box_exchange）中新增一条记录，包含正确的用户ID、活动ID、宝箱ID、消耗积分等信息
- 用户奖励记录表中新增对应的奖励记录
- 返回的剩余积分与实际数据库记录一致

#### TC-4.2.2 兑换宝箱-积分不足

**测试目的**：验证系统对积分不足情况的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户积分不足以兑换目标宝箱（例如用户有1500积分，宝箱需要2000积分）

**测试步骤**：
1. 记录用户当前积分
2. 调用兑换宝箱API，参数为宝箱ID
3. 检查系统响应

**预期结果**：
- 返回状态码表示错误（非0）
- 返回错误信息表明积分不足（错误码4001）
- 用户积分不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户积分表的积分字段未变化
- 用户宝箱兑换表中未新增记录
- 错误信息中应包含用户当前积分和所需积分信息

#### TC-4.2.3 兑换宝箱-重复兑换

**测试目的**：验证系统对重复兑换宝箱的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的积分
- 用户已经兑换过该宝箱（在demo_user_box_exchange表中有记录）

**测试步骤**：
1. 记录用户当前积分
2. 调用兑换宝箱API，参数为已兑换过的宝箱ID
3. 检查系统响应

**预期结果**：
- 返回状态码表示错误（非0）
- 返回错误信息表明已兑换过该宝箱（错误码4002）
- 用户积分不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户积分表的积分字段未变化
- 用户宝箱兑换表中未新增记录
- 错误信息应明确指出该宝箱已被兑换

#### TC-4.2.4 兑换宝箱-宝箱不存在

**测试目的**：验证系统对不存在宝箱的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的积分

**测试步骤**：
1. 调用兑换宝箱API，参数为不存在的宝箱ID（例如ID=999）
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误（非0）
- 返回错误信息表明宝箱不存在（错误码1001）
- 用户积分不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户积分表的积分字段未变化
- 用户宝箱兑换表中未新增记录
- 错误信息应明确指出宝箱不存在

#### TC-4.2.5 兑换宝箱-达到每日限制

**测试目的**：验证系统对宝箱每日兑换限制的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的积分
- 宝箱配置了每日兑换限制（daily_limit字段有值，例如3次/天）
- 用户当天已达到该宝箱的每日兑换限制

**测试步骤**：
1. 调用兑换宝箱API，参数为已达到每日限制的宝箱ID
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误（非0）
- 返回错误信息表明已达到每日兑换限制
- 用户积分不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户积分表的积分字段未变化
- 用户宝箱兑换表中未新增记录
- 错误信息应明确指出已达到每日兑换限制

#### TC-4.2.6 兑换宝箱-达到总限制

**测试目的**：验证系统对宝箱总兑换限制的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有足够的积分
- 宝箱配置了总兑换限制（total_limit字段有值，例如100次）
- 所有用户兑换该宝箱的总次数已达到限制

**测试步骤**：
1. 调用兑换宝箱API，参数为已达到总限制的宝箱ID
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误（非0）
- 返回错误信息表明宝箱已兑换完毕
- 用户积分不变

**验证标准**：
- 系统返回适当的错误码和错误信息
- 数据库中用户积分表的积分字段未变化
- 用户宝箱兑换表中未新增记录
- 错误信息应明确指出宝箱已兑换完毕

#### TC-4.2.7 兑换宝箱-并发兑换

**测试目的**：验证系统在多用户并发兑换同一宝箱时的数据一致性

**前置条件**：
- 活动状态为进行中
- 准备多个测试用户账号，每个用户都有足够的积分
- 宝箱配置了总兑换限制（例如只剩下5个）
- 准备10个用户同时兑换

**测试步骤**：
1. 使用性能测试工具模拟10个用户同时调用兑换宝箱API，参数为同一个宝箱ID
2. 检查每个请求的响应和数据库状态

**预期结果**：
- 只有5个用户兑换成功，返回状态码200
- 其余5个用户兑换失败，返回错误信息表明宝箱已兑换完毕
- 成功兑换的用户积分正确扣减
- 失败兑换的用户积分不变

**验证标准**：
- 系统正确处理并发请求
- 数据库事务处理正确，无数据不一致情况
- 宝箱总兑换次数不超过限制
- 每个用户只能兑换一次该宝箱

### 4.3 兑换记录测试

#### TC-4.3.1 获取兑换记录-正常场景

**测试目的**：验证系统能够正确返回用户的宝箱兑换记录

**前置条件**：
- 用户已登录系统
- 用户有多条宝箱兑换记录

**测试步骤**：
1. 调用获取兑换记录API（GET /api/box/records）
2. 检查返回的兑换记录

**预期结果**：
- 返回状态码为200
- 返回数据包含用户的所有宝箱兑换记录，包括兑换ID、宝箱ID、名称、等级、兑换时间、消耗积分、获得奖励等
- 默认返回第一页，每页10条记录

**验证标准**：
- 返回的兑换记录与数据库中的记录一致
- 所有字段格式正确
- 记录按兑换时间倒序排列（最新的记录在前）
- 返回的总记录数与用户实际兑换记录数一致

#### TC-4.3.2 获取兑换记录-无记录

**测试目的**：验证系统对无兑换记录情况的处理

**前置条件**：
- 用户已登录系统
- 用户没有宝箱兑换记录

**测试步骤**：
1. 调用获取兑换记录API
2. 检查系统响应

**预期结果**：
- 返回状态码为200
- 返回数据中records为空数组
- 返回总记录数为0

**验证标准**：
- 系统正确返回空列表，而不是错误
- 返回格式符合API规范
- 分页信息正确（total=0, pageNum=1）

#### TC-4.3.3 获取兑换记录-分页查询

**测试目的**：验证系统的分页查询功能

**前置条件**：
- 用户已登录系统
- 用户有多条宝箱兑换记录（至少25条）

**测试步骤**：
1. 调用获取兑换记录API，设置分页参数（pageNum=2, pageSize=10）
2. 检查返回的兑换记录

**预期结果**：
- 返回状态码为200
- 返回数据包含第二页的10条兑换记录
- 返回总记录数和当前页码

**验证标准**：
- 返回的记录数量为10条
- 返回的记录对应第11-20条记录
- 分页信息正确（total≥25, pageNum=2, pageSize=10）
- 记录按兑换时间倒序排列

#### TC-4.3.4 获取兑换记录-排序验证

**测试目的**：验证兑换记录的排序逻辑

**前置条件**：
- 用户已登录系统
- 用户在不同时间有多条宝箱兑换记录

**测试步骤**：
1. 用户新兑换一个宝箱，记录兑换时间
2. 立即调用获取兑换记录API
3. 检查返回的兑换记录排序

**预期结果**：
- 返回状态码为200
- 最新兑换的记录应该排在第一位
- 其他记录按兑换时间倒序排列

**验证标准**：
- 记录严格按照兑换时间（created_time字段）倒序排列
- 最新兑换的记录显示在列表最前面
- 排序逻辑在分页场景下依然正确
## 5. 排行榜测试

### 5.1 积分排行榜测试

#### TC-5.1.1 获取积分排行榜-正常场景

**测试目的**：验证系统能够正确返回活动的积分排行榜

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 数据库中存在排行榜数据

**测试步骤**：
1. 调用获取积分排行榜API（GET /api/leaderboard/points）
2. 检查返回的排行榜数据

**预期结果**：
- 返回状态码为200
- 返回数据包含排行榜信息，包括用户ID、用户名、头像、积分和排名
- 数据按积分降序排列

**验证标准**：
- 返回的排行榜数据与数据库中的记录一致
- 排名计算正确
- 所有字段格式正确

#### TC-5.1.2 获取积分排行榜-分页查询

**测试目的**：验证系统的排行榜分页查询功能

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 数据库中存在大量排行榜数据

**测试步骤**：
1. 调用获取积分排行榜API，设置分页参数
2. 检查返回的排行榜数据

**预期结果**：
- 返回状态码为200
- 返回数据包含指定页的排行榜信息
- 返回总记录数和总页数

**验证标准**：
- 返回的记录数量符合每页记录数设置
- 返回的记录对应正确的页码
- 分页信息正确

#### TC-5.1.3 获取积分排行榜-活动未开始

**测试目的**：验证系统在活动未开始时的处理逻辑

**前置条件**：
- 活动状态为未开始
- 用户已登录系统

**测试步骤**：
1. 调用获取积分排行榜API
2. 检查系统响应

**预期结果**：
- 返回状态码表示错误
- 返回错误信息表明活动未开始

**验证标准**：
- 系统返回适当的错误码和错误信息

#### TC-5.1.4 获取积分排行榜-无数据

**测试目的**：验证系统对无排行榜数据情况的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 数据库中不存在排行榜数据

**测试步骤**：
1. 调用获取积分排行榜API
2. 检查系统响应

**预期结果**：
- 返回状态码为200
- 返回空列表

**验证标准**：
- 系统正确返回空列表，而不是错误
- 返回格式符合API规范

### 5.2 排行榜奖励测试

#### TC-5.2.1 获取排行榜奖励配置

**测试目的**：验证系统能够正确返回排行榜奖励配置

**前置条件**：
- 用户已登录系统
- 数据库中存在排行榜奖励配置

**测试步骤**：
1. 调用获取排行榜奖励配置API（GET /api/leaderboard/rewards）
2. 检查返回的奖励配置

**预期结果**：
- 返回状态码为200
- 返回数据包含排行榜奖励配置，包括排名范围、奖励类型、奖励名称和奖励数量

**验证标准**：
- 返回的奖励配置与数据库中的记录一致
- 所有字段格式正确

#### TC-5.2.2 排行榜奖励发放-活动结束

**测试目的**：验证系统在活动结束时能够正确发放排行榜奖励

**前置条件**：
- 活动状态为进行中
- 数据库中存在排行榜数据和奖励配置
- 系统时间接近活动结束时间

**测试步骤**：
1. 等待活动结束
2. 检查系统是否自动发放排行榜奖励
3. 检查用户奖励记录

**预期结果**：
- 系统在活动结束后自动发放排行榜奖励
- 排名在奖励范围内的用户获得对应奖励

**验证标准**：
- 用户奖励记录表中新增排行榜奖励记录
- 奖励发放符合配置要求
- 只有符合排名范围的用户获得奖励

### 5.3 个人排名测试

#### TC-5.3.1 获取个人排名-正常场景

**测试目的**：验证系统能够正确返回用户的个人排名

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户在排行榜中有排名

**测试步骤**：
1. 调用获取个人排名API（GET /api/leaderboard/myrank）
2. 检查返回的排名信息

**预期结果**：
- 返回状态码为200
- 返回数据包含用户的排名、积分、与上一名的积分差距等信息

**验证标准**：
- 返回的排名与数据库中的记录一致
- 积分差距计算正确
- 所有字段格式正确

#### TC-5.3.2 获取个人排名-用户无排名

**测试目的**：验证系统对用户无排名情况的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户在排行榜中没有排名（未获得积分）

**测试步骤**：
1. 调用获取个人排名API
2. 检查系统响应

**预期结果**：
- 返回状态码为200
- 返回数据表明用户无排名，积分为0

**验证标准**：
- 系统正确处理无排名情况
- 返回格式符合API规范

#### TC-5.3.3 排名变化测试

**测试目的**：验证系统能够正确处理排名变化

**前置条件**：
- 活动状态为进行中
- 用户A和用户B已登录系统
- 用户A的积分略高于用户B

**测试步骤**：
1. 记录用户A和用户B的当前排名
2. 用户B获得足够积分超过用户A
3. 再次查询两个用户的排名

**预期结果**：
- 用户B的排名提升
- 用户A的排名下降

**验证标准**：
- 排名变化及时反映在排行榜中
- 排名计算正确
## 6. 综合功能测试

### 6.1 用户活动数据测试

#### TC-6.1.1 获取用户活动数据-正常场景

**测试目的**：验证系统能够正确返回用户的活动相关数据

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户有活动参与记录

**测试步骤**：
1. 调用获取用户活动数据API（GET /api/user/activity-data）
2. 检查返回的用户数据

**预期结果**：
- 返回状态码为200
- 返回数据包含用户的游戏进度、积分、排名、宝箱兑换情况等综合信息

**验证标准**：
- 返回的用户数据与数据库中的记录一致
- 所有字段格式正确
- 数据完整性符合要求

#### TC-6.1.2 获取用户活动数据-首次参与

**测试目的**：验证系统对首次参与活动用户的处理

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 用户无活动参与记录

**测试步骤**：
1. 调用获取用户活动数据API
2. 检查系统响应

**预期结果**：
- 返回状态码为200
- 返回初始化的用户数据，如游戏位置为0，积分为0等

**验证标准**：
- 系统正确处理首次参与情况
- 返回格式符合API规范
- 初始化数据符合业务逻辑

### 6.2 一次性获取所有数据测试

#### TC-6.2.1 一次性获取所有活动数据-正常场景

**测试目的**：验证系统能够一次性返回所有活动相关数据

**前置条件**：
- 活动状态为进行中
- 用户已登录系统

**测试步骤**：
1. 调用一次性获取所有活动数据API（GET /api/activity/all-data）
2. 检查返回的数据

**预期结果**：
- 返回状态码为200
- 返回数据包含活动信息、游戏格子配置、用户游戏进度、宝箱列表、排行榜数据等所有相关信息

**验证标准**：
- 返回的数据与多个单独API调用结果一致
- 所有字段格式正确
- 数据完整性符合要求

#### TC-6.2.2 一次性获取所有活动数据-性能测试

**测试目的**：验证一次性获取所有数据的API性能

**前置条件**：
- 活动状态为进行中
- 用户已登录系统
- 数据库中存在大量数据

**测试步骤**：
1. 记录开始时间
2. 调用一次性获取所有活动数据API
3. 记录结束时间，计算响应时间
4. 与多次单独调用各API的总时间比较

**预期结果**：
- 一次性获取所有数据的响应时间明显优于多次单独调用
- 返回数据完整正确

**验证标准**：
- 响应时间在可接受范围内（建议不超过1秒）
- 数据一致性和完整性得到保证

## 7. 性能测试

### 7.1 并发测试

#### TC-7.1.1 游戏进行并发测试

**测试目的**：验证系统在多用户同时进行游戏时的稳定性

**前置条件**：
- 活动状态为进行中
- 准备多个测试用户账号，每个用户有足够的游戏机会

**测试步骤**：
1. 使用性能测试工具模拟100个用户同时调用使用游戏机会API
2. 监控系统响应和数据库状态

**预期结果**：
- 所有请求都能得到正确处理
- 系统保持稳定，无异常错误
- 数据库事务处理正确，无数据不一致情况

**验证标准**：
- 成功率达到99%以上
- 平均响应时间在可接受范围内（建议不超过500ms）
- 数据库记录与请求一致

#### TC-7.1.2 宝箱兑换并发测试

**测试目的**：验证系统在多用户同时兑换宝箱时的稳定性

**前置条件**：
- 活动状态为进行中
- 准备多个测试用户账号，每个用户有足够的积分

**测试步骤**：
1. 使用性能测试工具模拟50个用户同时调用兑换宝箱API
2. 监控系统响应和数据库状态

**预期结果**：
- 所有请求都能得到正确处理
- 系统保持稳定，无异常错误
- 数据库事务处理正确，无数据不一致情况

**验证标准**：
- 成功率达到99%以上
- 平均响应时间在可接受范围内
- 积分扣减和奖励发放正确

### 7.2 响应时间测试

#### TC-7.2.1 关键API响应时间测试

**测试目的**：验证系统关键API的响应时间

**前置条件**：
- 系统正常运行
- 数据库中存在一定量的数据

**测试步骤**：
1. 分别测试以下API的响应时间：
   - 获取活动信息API
   - 使用游戏机会API
   - 获取排行榜API
   - 兑换宝箱API
   - 一次性获取所有数据API
2. 记录每个API的平均响应时间

**预期结果**：
- 所有API的响应时间在可接受范围内
- 一次性获取所有数据API的响应时间不超过1秒

**验证标准**：
- 单个简单API响应时间不超过200ms
- 复杂API响应时间不超过500ms
- 一次性获取所有数据API响应时间不超过1秒

#### TC-7.2.2 高负载下响应时间测试

**测试目的**：验证系统在高负载下的响应时间

**前置条件**：
- 系统正常运行
- 准备性能测试环境

**测试步骤**：
1. 模拟系统正常负载的3倍并发请求
2. 测试关键API的响应时间
3. 监控系统资源使用情况

**预期结果**：
- 系统能够承受高负载
- 响应时间增长在可接受范围内
- 系统资源使用率不超过阈值

**验证标准**：
- 高负载下响应时间增长不超过50%
- CPU使用率不超过80%
- 内存使用率不超过80%
- 无连接超时或请求失败

## 8. 安全测试

### 8.1 权限控制测试

#### TC-8.1.1 未授权访问测试

**测试目的**：验证系统对未授权访问的防护

**前置条件**：
- 系统正常运行

**测试步骤**：
1. 不携带认证信息调用各API
2. 检查系统响应

**预期结果**：
- 所有需要认证的API返回401未授权错误
- 系统不泄露敏感信息

**验证标准**：
- 认证机制正常工作
- 错误信息不包含敏感信息

#### TC-8.1.2 越权访问测试

**测试目的**：验证系统对越权访问的防护

**前置条件**：
- 准备不同权限级别的测试账号

**测试步骤**：
1. 使用低权限账号尝试访问高权限功能
2. 检查系统响应

**预期结果**：
- 系统拒绝越权访问，返回403禁止访问错误
- 系统日志记录越权尝试

**验证标准**：
- 权限控制机制正常工作
- 越权尝试被正确记录

### 8.2 数据安全测试

#### TC-8.2.1 SQL注入防护测试

**测试目的**：验证系统对SQL注入攻击的防护

**前置条件**：
- 系统正常运行

**测试步骤**：
1. 在API参数中注入SQL语句片段
2. 检查系统响应

**预期结果**：
- 系统正确处理输入，不执行注入的SQL
- 系统返回适当的错误信息

**验证标准**：
- 参数化查询机制正常工作
- 无数据泄露或未授权访问

#### TC-8.2.2 敏感数据保护测试

**测试目的**：验证系统对敏感数据的保护

**前置条件**：
- 系统正常运行

**测试步骤**：
1. 检查API响应中的敏感数据处理
2. 检查数据库中敏感数据的存储方式

**预期结果**：
- API响应中敏感数据被适当处理（如脱敏、加密）
- 数据库中敏感数据被安全存储

**验证标准**：
- 敏感数据保护机制正常工作
- 符合数据保护相关规定
